---
layout:     post                     # 使用的布局（不需要改）
title:      前端模块化                      # 标题 
subtitle:   模块化编程                # 副标题
date:       2019-12-22               # 时间
author:     极客小祥                      # 作者
header-img: img/text/WEB.jpg         # 这篇文章标题背景图片
catalog: true                        # 是否归档
tags:                                # 标签
    - WEB
---

# 模块化概述

#### 1、基础
* 模块化就是把**单独的一个功能封装到一个模块中，模块之间相互隔离，但是可以通过特定的接口公开内部成员，也可以依赖别的模块**
* 好处：**方便代码的重用，从而提升开发效率，方便后期维护**

#### 2、服务器端CommonJS模块化规范
* 模块分为**单文件模块和包**
* 模块成**导出**使用：**module.exports和exports**
* 模块成员**导入**使用：**require('模块标识符')**

#### 3、ES6模块化规范
1. 每个JS文件都是**一个独立的模块**
2. **导入模块成员**使用**import**关键字
3. **暴露模块成员**使用**export**关键字

# webpack

#### 1、基础使用
1. 运行**npm install webpack webpack-cli -D**安装
2. 在项目根目录，创建名**webpack.config.js**的配置文件
3. 在**webpack**的配置文件，初始化配置**development和production**
	* development**不会压缩**js文件
	* production会**进行压缩**

	```javascript
	module.exports = {
		mode: 'development' // mode用来指定构建模式
	}
	```

4. 在**package.json**的配置文件中的**scripts**节点下，新增**dev**脚本

	```javascript
	"scripts":{
		"dev":"webpack" // script下的脚本可以使用npm run执行
	}
	```

5. 在终端运行**npm run dev**命令执行，启动webpack**进行项目打包**

#### 2、配置打包的入口和出口

* 打包的默认**入口文件**为**src/index.js**
* 打包的默认**出口文件**为**dist/main.js**

* 修改再**webpack.config.js**中配置

	```javascript
	const path = require('path') // 导入 node.js 中专门操作路径的模块
	module.exports = {
		entry:path.join(__dirname,'./src/index.js'), // 打包的入口文件路径
		output:{
			path:path.join(__dirname,'./dist'), // 输出文件的存放路径
			filename:'bundle.js' // 输出文件的名字
		}
	}
	```

#### 3、配置自动打包

1. 运行**npm i webpack-dev-server -D**命令，安装自动打包工具
2. 修改**package.json->scripts**中的**dev**为
	
	```javascript
	"scripts":{
		"dev":"webpack-dev-server" // script下的脚本可以使用npm run执行
	}
	```

3. 将**src/index.html中script脚本引入路径修改为/bundle.js**
4. 运行**npm run dev**命令
5. 在浏览器访问**http://localhost:8080**

* webpack-dev-server会启动一个**实时打包的http服务器**
* webpack-dev-server打包生成的输出文件，默认放在了**项目根目录而且是虚拟的**

#### 4、配置html-webpack-plugin

1. 运行**npm i html-webpack-plugin -D**安装
2. 修改**webpack.config.js文件**

	```javascript
	// 导入生成预览页面的插件，得到一个构造函数
	const HtmlWebpackPlugin = require('html-webpack-plugin');
	const htmlPlugin = new HtmlWebpackPlugin({
		// 创建插件的实例对象
		template:'./src/index.html', // 指定要创建的模板
		filename:'index.html' // 指定生成文件的名字，文件是虚拟的
	})
	```

3. 修改**webpack.config.js**文件中向外暴露的配置对象，新增配置节点

	```javascript
	module.exports = {
		plugins:[ htmlPlugin ] // plugins数组是webpack打包期间会用到的一些插件列表
	}
	```

#### 5、打包参数配置

* 在**package.json**中配置
	1. **--open**：打包完成后自动打开浏览器
	2. **--host**：配置ip地址
	3. **--port**：配置端口

```javascript
  "scripts": {
    "dev": "webpack-dev-server --open --host 127.0.0.1 --port 8888"
  }
```

#### 6、webpack加载器
* webpack默认**只能打包以js结尾的文件**，打包其他文件需要调用**loader加载器**

1. 打包**css文件**
	* 运行**npm i style-loader css-loader -D**安装
	* 配置**webpack.config.js**的**module->rules数组中**

		```javascript
		module.exports = {
			module:{
				rules:[
					// test表示匹配的文件类型，use表示对应要调用的loader
					{test:/\.css$/,use:['style-loader','css-loader']}
				]
			}
		}
		```

	* 注意：
		1. **use**数组中指定的**loader顺序是固定的**
		2. 多个loader的调用顺序是**从后往前调用**
2. 打包**.less**文件
	* 运行**npm i less-loader less -D**安装
	* 配置**webpack.config.js**的**module->rules数组中**

		```javascript
		module.exports = {
			module:{
				rules:[
					// test表示匹配的文件类型，use表示对应要调用的loader
					{test:/\.less$/,use:['style-loader','css-loader','less-loader']}
				]
			}
		}
		```

3. 打包**scss**文件
	* 运行**npm i sass-loader node-sass -D**安装
	* 配置**webpack.config.js**的**module->rules数组中**

		```javascript
		module.exports = {
			module:{
				rules:[
					// test表示匹配的文件类型，use表示对应要调用的loader
					{test:/\.scss$/,use:['style-loader','css-loader','sass-loader']}
				]
			}
		}
		```

4. 配置**postCSS**自动添加css**兼容前缀**
	* 运行**npm i postcss-loader autoprefixer -D**安装
	* 在项目根目录创建**postcss配置文件postcss.config.js**，初始化配置

		```javascript
		const autoprefixer = require('autoprefixer'); // 导入插件
		module.exports = {
			plugins:[autoprefixer] // 挂载插件
		}
		```

	* 在**webpack.config.js的module->rules数组中**，修改css的loader

		```javascript
		module.exports = {
			module:{
				rules:[
					// test表示匹配的文件类型，use表示对应要调用的loader
					{test:/\.css$/,use:['style-loader','css-loader','postcss-loader']}
				]
			}
		}
		```

5. 打包**图片和字体文件**
	* 运行**npm i url-loader file-loader -D**安装
	* 配置**webpack.config.js**的**module->rules数组中**

		```javascript
		module.exports = {
			module:{
				rules:[
					// test表示匹配的文件类型，use表示对应要调用的loader
					{
						test:/\.jpg|png|gif|bmp|ttf|eop|svg|woff|woff2$/,
						// ?之后是loader的参数
						// limit用来指定图片的大小，单位是字节
						// 图片如果小于16940会被转为base64，不然不会被转
						use:'url-loader?limit=16940'
					}
				]
			}
		}
		```

6. 打包处理js文件的**高级语法**
	* 安装**babel转换器包**：**npm i babel-loader @babel/core @babel/runtime -D**
	* 安装**babel语法插件相关的包**：**npm i @babel/preset-env @babel/plugin-transform-runtime @babel/plugin-proposal-class-properties -D**
	* 在项目根目录创建babel配置文件**babel.config.js**初始化配置

		```javascript
		module.exports = {
			presets:['@babel/preset-env'],
			plugins:['@babel/plugin-transform-runtime','@babel/plugin-proposal-class-properties']
		}
		```
	
	* 在**webpack.config.js文件**的**module->rules**配置

		```javascript
		// exclude为排除项，表示babel-loader不需要处理node_modules中的js文件
		{test:/\.js$/,use:'babel-loader',exclude:/node_modules/}
		```

7. 打包**vue**组件
	* 运行**npm i vue-loader vue-template-compiler -D**安装
	* 在**webpack.config.js文件**添加**vue-loader**配置

		```javascript
		const VueLoaderPlugin = require('vue-loader/lib/plugin')
		module.exports = {
			module:{
				rules:[
					{test:/\.vue$/,use:'vue-loader'}
				]
			},
			plugins:[
				new VueLoaderPlugin()  // 引入插件
			]
		}
		```

#### 7、打包和发布
* 配置**package.json**

```javascript
"scripts":{
	"build":"webpack -p",
	// 用于开发调试的命令
	"dev":"webpack-dev-server"
}
```